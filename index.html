<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>미술교과 기반 지역연계 학교예술교육 워크숍</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #F9F9F7;
            color: #333333;
        }
        .section-card {
            background-color: #FFFFFF;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border: 1px solid #EDEDED;
        }
        .nav-button {
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
        }
        .nav-button.active {
            color: #4A90E2;
            border-bottom-color: #4A90E2;
        }
        .nav-button:hover {
            color: #4A90E2;
            background-color: #F0F5FA;
        }
        .case-card {
            perspective: 1000px;
        }
        .case-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .case-card.flipped .case-card-inner {
            transform: rotateY(180deg);
        }
        .case-card-front, .case-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 0.75rem;
            padding: 1.5rem;
        }
        .case-card-front {
            background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
            color: #334155;
        }
        .case-card-back {
            background-color: #ffffff;
            border: 1px solid #e2e8f0;
            transform: rotateY(180deg);
            overflow-y: auto;
            align-items: flex-start;
        }
        .step-indicator {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .step-indicator.active {
            background-color: #4A90E2;
            color: white;
            transform: scale(1.1);
        }
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.5rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #4A90E2;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal.hidden {
            display: none;
        }
        .api-key-button {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background-color: #4A90E2;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        .api-key-button:hover {
            background-color: #357ABD;
            transform: scale(1.1);
        }
        .api-key-button.active {
            background-color: #10B981;
        }
    </style>
</head>
<body>
    <!-- API 키 설정 버튼 -->
    <button id="api-key-btn" class="api-key-button" title="API 키 설정">🔑</button>

    <!-- API 키 설정 모달 -->
    <div id="api-modal" class="modal hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full mx-4">
            <h3 class="text-xl font-bold text-gray-800 mb-4">🔑 Gemini API 키 설정</h3>
            
            <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
                <h4 class="font-bold text-blue-800 mb-2">📋 API 키 발급 방법</h4>
                <ol class="text-sm text-blue-700 space-y-1 list-decimal list-inside">
                    <li><a href="https://aistudio.google.com/app/apikey" target="_blank" class="underline hover:text-blue-900">Google AI Studio</a>에 접속</li>
                    <li>"Create API Key" 버튼 클릭</li>
                    <li>생성된 API 키를 아래에 입력</li>
                </ol>
            </div>
            
            <div class="space-y-4">
                <input type="password" id="api-key-input" class="form-input" placeholder="Gemini API 키를 입력하세요 (예: AIzaSy...)">
                <div id="api-status" class="text-sm text-gray-600">API 키를 입력하면 AI 추천 기능을 사용할 수 있습니다.</div>
                <div class="flex space-x-3">
                    <button id="api-save-btn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg">저장</button>
                    <button id="api-cancel-btn" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">취소</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800">미술교과 기반 지역연계 학교예술교육</h1>
            <p class="text-lg text-gray-500 mt-4">초등 교원을 위한 실습 중심 워크숍</p>
            
            <!-- API 상태 표시 -->
            <div id="api-status-banner" class="mt-4 p-3 rounded-lg bg-yellow-50 border border-yellow-200 text-yellow-800 text-sm">
                ⚠️ AI 기능을 사용하려면 우측 상단의 🔑 버튼을 클릭하여 API 키를 설정해주세요.
            </div>
        </header>

        <nav class="sticky top-0 bg-white/80 backdrop-blur-sm z-10 shadow-sm rounded-lg mb-12">
            <div class="max-w-5xl mx-auto px-4">
                <div class="flex justify-center space-x-2 md:space-x-8">
                    <button data-target="intro" class="nav-button active font-semibold py-4 px-2 md:px-4 text-sm md:text-base">⏰ 연수 시작</button>
                    <button data-target="cases" class="nav-button font-semibold py-4 px-2 md:px-4 text-sm md:text-base">🎨 사례 탐구</button>
                    <button data-target="workshop" class="nav-button font-semibold py-4 px-2 md:px-4 text-sm md:text-base">💡 수업 설계</button>
                    <button data-target="wrapup" class="nav-button font-semibold py-4 px-2 md:px-4 text-sm md:text-base">📝 정리 및 공유</button>
                </div>
            </div>
        </nav>

        <main id="content-container">
            <!-- 연수 시작 섹션 -->
            <section id="intro" class="content-section">
                <div class="max-w-4xl mx-auto section-card p-8 md:p-12">
                    <h2 class="text-3xl font-bold mb-6 text-gray-800">🚀 함께 시작하기: 우리 동네 보물찾기</h2>
                    <p class="text-gray-600 mb-8 leading-relaxed">
                        안녕하세요, 선생님! 이번 연수에 오신 것을 환영합니다. 이 시간은 이론 학습을 넘어, 선생님께서 직접 '지역사회'라는 살아있는 교육 자원을 활용하여 학생들을 위한 특별한 미술 수업을 기획하는 실습의 장입니다.
                    </p>
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg mb-8">
                        <h3 class="font-bold text-xl mb-2 text-blue-800">오늘의 연수 목표</h3>
                        <ul class="list-disc list-inside text-blue-700 space-y-2">
                            <li>지역연계 예술교육의 개념과 가치를 이해합니다.</li>
                            <li>다양한 성공 사례를 통해 아이디어를 얻습니다.</li>
                            <li>나만의 지역연계 미술 수업을 직접 설계하고 구체화합니다.</li>
                        </ul>
                    </div>
                    
                    <h3 class="font-bold text-2xl mb-4 text-gray-700">ICE-BREAKING: 우리 학교 1km 반경에는?</h3>
                    <p class="text-gray-600 mb-6">수업 설계를 시작하기 전, 잠시 우리 학교 주변을 떠올려볼까요?</p>
                    <div class="flex flex-wrap gap-4 text-center">
                        <span class="bg-yellow-100 text-yellow-800 text-base font-medium px-4 py-2 rounded-full">🌳 공원/숲</span>
                        <span class="bg-green-100 text-green-800 text-base font-medium px-4 py-2 rounded-full">🏛️ 작은 박물관/미술관</span>
                        <span class="bg-indigo-100 text-indigo-800 text-base font-medium px-4 py-2 rounded-full">시장/상점가</span>
                        <span class="bg-purple-100 text-purple-800 text-base font-medium px-4 py-2 rounded-full">🧑‍🎨 지역 예술가/장인</span>
                        <span class="bg-pink-100 text-pink-800 text-base font-medium px-4 py-2 rounded-full">📜 오래된 건물/역사 유적</span>
                        <span class="bg-gray-200 text-gray-800 text-base font-medium px-4 py-2 rounded-full">🏢 공공기관</span>
                    </div>
                </div>
            </section>

            <!-- 사례 탐구 섹션 -->
            <section id="cases" class="content-section hidden">
                <div class="max-w-5xl mx-auto section-card p-8 md:p-12">
                    <h2 class="text-3xl font-bold mb-2 text-gray-800">🌍 가능성의 발견: 지역연계 교육 사례 탐구</h2>
                    <p class="text-gray-600 mb-8 leading-relaxed">
                        이미 전국의 많은 학교에서 지역사회의 특성을 살린 창의적인 미술 교육을 실천하고 있습니다. 각 카드를 클릭하여 자세한 내용을 살펴보세요.
                    </p>
                    
                    <div class="grid md:grid-cols-2 gap-8 mb-12">
                        <div class="chart-container relative h-[300px]">
                            <canvas id="caseTypeChart"></canvas>
                        </div>
                        <div class="flex flex-col justify-center">
                            <h3 class="font-bold text-2xl mb-4 text-gray-700">사례 유형 분석</h3>
                            <p class="text-gray-600">지역연계 수업은 다양한 형태로 이루어집니다. '공공미술 프로젝트'처럼 학생들이 직접 지역 환경 개선에 참여하는 형태가 가장 많으며, '장소 탐방'이나 '전문가 협력' 수업도 활발히 이루어지고 있습니다.</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="case-card h-64 cursor-pointer">
                            <div class="case-card-inner">
                                <div class="case-card-front">
                                    <h3 class="text-2xl font-bold">공공미술 프로젝트</h3>
                                    <p class="mt-2">우리 동네를 캔버스로!</p>
                                    <span class="mt-4 text-xs font-semibold">(클릭하여 자세히 보기)</span>
                                </div>
                                <div class="case-card-back text-left">
                                    <h4 class="font-bold text-lg mb-2">마을 벽화 그리기</h4>
                                    <p class="text-sm text-gray-600">
                                        <strong>대상:</strong> 5~6학년<br>
                                        <strong>연계자원:</strong> 지역 주민센터, 노후 담벼락<br>
                                        <strong>활동:</strong> 우리 동네 이야기 리서치 → 디자인 시안 제작 및 발표 → 주민 의견 수렴 → 함께 벽화 제작<br>
                                        <strong>성과:</strong> 환경 개선, 공동체 의식 함양
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="case-card h-64 cursor-pointer">
                            <div class="case-card-inner">
                                <div class="case-card-front">
                                    <h3 class="text-2xl font-bold">장소 탐방 & 재해석</h3>
                                    <p class="mt-2">익숙한 공간, 새롭게 보기</p>
                                    <span class="mt-4 text-xs font-semibold">(클릭하여 자세히 보기)</span>
                                </div>
                                <div class="case-card-back text-left">
                                    <h4 class="font-bold text-lg mb-2">전통시장 드로잉</h4>
                                    <p class="text-sm text-gray-600">
                                        <strong>대상:</strong> 3~4학년<br>
                                        <strong>연계자원:</strong> 지역 전통시장<br>
                                        <strong>활동:</strong> 시장 방문하여 오감으로 관찰하기 → 상인 인터뷰 및 사진 촬영 → 가장 인상 깊은 모습 드로잉/콜라주로 표현 → '우리 시장 전시회' 개최<br>
                                        <strong>성과:</strong> 관찰력, 표현력, 지역 경제 이해
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="case-card h-64 cursor-pointer">
                            <div class="case-card-inner">
                                <div class="case-card-front">
                                    <h3 class="text-2xl font-bold">전문가 협력 수업</h3>
                                    <p class="mt-2">마을 장인에게 한 수 배우기</p>
                                    <span class="mt-4 text-xs font-semibold">(클릭하여 자세히 보기)</span>
                                </div>
                                <div class="case-card-back text-left">
                                    <h4 class="font-bold text-lg mb-2">도예가와 함께하는 컵 만들기</h4>
                                    <p class="text-sm text-gray-600">
                                        <strong>대상:</strong> 전학년<br>
                                        <strong>연계자원:</strong> 지역 도예 공방 작가<br>
                                        <strong>활동:</strong> 작가 초빙하여 직업 이야기 듣기 → 흙의 성질 탐구 → 1인 1컵 디자인 및 제작 → 가마 소성 후 작품 감상<br>
                                        <strong>성과:</strong> 진로 탐색, 조형 능력, 재료 이해
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 수업 설계 섹션 -->
            <section id="workshop" class="content-section hidden">
                <div class="max-w-4xl mx-auto section-card p-8 md:p-12">
                    <h2 class="text-3xl font-bold mb-2 text-gray-800">🛠️ 나만의 수업 설계하기</h2>
                    <p class="text-gray-600 mb-8 leading-relaxed">
                        이제 본격적으로 선생님만의 지역연계 미술 수업을 구상할 시간입니다. 아래 4가지 단계를 따라가며 빈칸을 채워보세요.
                    </p>

                    <div class="flex justify-around mb-8">
                        <div class="step-indicator w-16 h-16 flex items-center justify-center rounded-full border-2 border-gray-300 active" data-step="0">1</div>
                        <div class="step-indicator w-16 h-16 flex items-center justify-center rounded-full border-2 border-gray-300" data-step="1">2</div>
                        <div class="step-indicator w-16 h-16 flex items-center justify-center rounded-full border-2 border-gray-300" data-step="2">3</div>
                        <div class="step-indicator w-16 h-16 flex items-center justify-center rounded-full border-2 border-gray-300" data-step="3">4</div>
                    </div>
                    
                    <!-- 1단계: 자원 탐색 -->
                    <div id="step-0" class="workshop-step">
                        <h3 class="font-bold text-2xl mb-4 text-gray-700">1단계: 우리 동네 자원 탐색</h3>
                        <p class="text-gray-600 mb-6">우리 학교 주변에서 미술 수업과 연결할 수 있는 자원은 무엇이 있을까요?</p>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">학년 선택:</label>
                            <select id="grade-select" class="form-input">
                                <option value="">학년을 선택하세요</option>
                                <option value="1-2학년">1-2학년</option>
                                <option value="3-4학년">3-4학년</option>
                                <option value="5-6학년">5-6학년</option>
                            </select>
                        </div>
                        
                        <textarea id="resource-input" class="form-input" rows="4" placeholder="자유롭게 기록해보세요..."></textarea>
                        
                        <button id="suggest-ideas-btn" class="mt-4 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-6 rounded-lg flex items-center disabled:opacity-50">
                            <span id="suggest-ideas-spinner" class="loading-spinner mr-2 hidden"></span>
                            ✨ 아이디어 제안 받기
                        </button>
                        <div id="suggested-ideas-output" class="mt-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-indigo-800 hidden"></div>
                        
                        <div class="mt-6 flex justify-end">
                            <button class="next-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">다음 단계로</button>
                        </div>
                    </div>

                    <!-- 2단계: 교육과정 연결 -->
                    <div id="step-1" class="workshop-step hidden">
                        <h3 class="font-bold text-2xl mb-4 text-gray-700">2단계: 교육과정 연결 및 주제 정하기</h3>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">선택된 동네 자원:</label>
                            <p id="selected-resource" class="form-input bg-gray-100 text-gray-600"></p>
                        </div>

                        <div class="mb-6">
                            <label class="block text-gray-700 text-sm font-bold mb-2">핵심 역량:</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                <label class="flex items-center">
                                    <input type="checkbox" name="competency" value="심미적 감성 역량" class="mr-2">
                                    <span>심미적 감성 역량</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="competency" value="시각적 소통 역량" class="mr-2">
                                    <span>시각적 소통 역량</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="competency" value="창의∙융합 역량" class="mr-2">
                                    <span>창의∙융합 역량</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="competency" value="공동체 역량" class="mr-2">
                                    <span>공동체 역량</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">학습 주제:</label>
                            <textarea id="topic-input" class="form-input" rows="2" placeholder="수업 주제를 기록해보세요..."></textarea>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">학습 목표:</label>
                            <textarea id="objectives-input" class="form-input" rows="4" placeholder="학습 목표를 구체적으로 작성해보세요..."></textarea>
                            <button id="suggest-objectives-btn" class="mt-2 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg flex items-center disabled:opacity-50">
                                <span id="suggest-objectives-spinner" class="loading-spinner mr-2 hidden"></span>
                                ✨ 학습 목표 제안
                            </button>
                            <div id="suggested-objectives-output" class="mt-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-indigo-800 hidden"></div>
                        </div>

                        <div class="mt-6 flex justify-between">
                            <button class="prev-btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg">이전 단계로</button>
                            <button class="next-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">다음 단계로</button>
                        </div>
                    </div>

                    <!-- 3단계: 활동 구체화 -->
                    <div id="step-2" class="workshop-step hidden">
                        <h3 class="font-bold text-2xl mb-4 text-gray-700">3단계: 활동 내용 구체화</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">도입:</label>
                                <textarea id="intro-input" class="form-input" rows="3" placeholder="흥미 유발, 동기 부여 활동..."></textarea>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">전개:</label>
                                <textarea id="main-input" class="form-input" rows="6" placeholder="핵심 탐구 및 표현 활동..."></textarea>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">정리:</label>
                                <textarea id="wrap-input" class="form-input" rows="3" placeholder="작품 공유, 느낀 점 나누기..."></textarea>
                            </div>
                        </div>

                        <button id="suggest-activities-btn" class="mt-4 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-6 rounded-lg flex items-center disabled:opacity-50">
                            <span id="suggest-activities-spinner" class="loading-spinner mr-2 hidden"></span>
                            ✨ 활동 아이디어 제안
                        </button>
                        <div id="suggested-activities-output" class="mt-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-indigo-800 hidden"></div>

                        <div class="mt-6 flex justify-between">
                            <button class="prev-btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg">이전 단계로</button>
                            <button class="next-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">다음 단계로</button>
                        </div>
                    </div>

                    <!-- 4단계: 기대 효과 -->
                    <div id="step-3" class="workshop-step hidden">
                        <h3 class="font-bold text-2xl mb-4 text-gray-700">4단계: 기대 효과 및 확장 방안</h3>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">기대 효과:</label>
                            <textarea id="effects-input" class="form-input" rows="4" placeholder="이 수업의 기대효과를 기록해보세요..."></textarea>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">확장 방안:</label>
                            <textarea id="expansion-input" class="form-input" rows="4" placeholder="수업의 확장 방안을 기록해보세요..."></textarea>
                            <button id="suggest-expansion-btn" class="mt-2 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg flex items-center disabled:opacity-50">
                                <span id="suggest-expansion-spinner" class="loading-spinner mr-2 hidden"></span>
                                ✨ 확장 방안 제안
                            </button>
                            <div id="suggested-expansion-output" class="mt-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-indigo-800 hidden"></div>
                        </div>

                        <div class="mt-6 flex justify-between">
                            <button class="prev-btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg">이전 단계로</button>
                            <button id="complete-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg">수업 설계 완료!</button>
                        </div>
                    </div>
                    
                    <!-- 완료 뷰 -->
                    <div id="complete-view" class="hidden mt-8 bg-gray-50 p-6 rounded-lg">
                        <h3 class="text-2xl font-bold text-center mb-6">🎉 나만의 수업 계획안이 완성되었습니다!</h3>
                        <div id="summary-content" class="space-y-4 text-gray-700"></div>
                        <div class="mt-6 flex justify-center space-x-4">
                            <button id="reset-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg">초기화</button>
                            <button id="download-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg">계획서 다운로드</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 정리 및 공유 섹션 -->
            <section id="wrapup" class="content-section hidden">
                <div class="max-w-4xl mx-auto section-card p-8 md:p-12">
                    <h2 class="text-3xl font-bold mb-6 text-gray-800">🌱 아이디어 공유 및 마무리</h2>
                    <p class="text-gray-600 mb-8 leading-relaxed">
                        모두 수고하셨습니다. 선생님들께서 만들어주신 수업 계획의 초안들은 정말 소중한 결과물입니다.
                    </p>
                    
                    <div class="bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg">
                        <h3 class="font-bold text-xl mb-2 text-green-800">토의 주제</h3>
                        <ul class="list-disc list-inside text-green-700 space-y-2">
                            <li>가장 인상 깊었던 동료 선생님의 수업 아이디어는 무엇인가요?</li>
                            <li>수업을 실행할 때 예상되는 어려움과 해결 방안은 무엇일까요?</li>
                            <li>우리 지역의 숨겨진 예술 자원에는 또 무엇이 있을까요?</li>
                        </ul>
                    </div>
                </div>
            </section>
        </main>

        <footer class="mt-12 py-6 text-center text-gray-500 text-sm border-t border-gray-200">
            <p>&copy; Copyright Yang Inseon. All rights reserved.</p>
            <p class="mt-2">본 코드는 수업 설계 및 활용을 위한 목적으로 제공됩니다.</p>
        </footer>
    </div>

    <script>
        // 전역 변수
        let currentStep = 0;
        let apiKey = '';
        const workshopData = {
            grade: '',
            resource: '',
            competencies: [],
            topic: '',
            objectives: '',
            intro: '',
            main: '',
            wrap: '',
            effects: '',
            expansion: ''
        };

        // DOM 요소들
        const elements = {
            apiKeyBtn: document.getElementById('api-key-btn'),
            apiModal: document.getElementById('api-modal'),
            apiKeyInput: document.getElementById('api-key-input'),
            apiSaveBtn: document.getElementById('api-save-btn'),
            apiCancelBtn: document.getElementById('api-cancel-btn'),
            apiStatusBanner: document.getElementById('api-status-banner'),
            navButtons: document.querySelectorAll('.nav-button'),
            contentSections: document.querySelectorAll('.content-section'),
            caseCards: document.querySelectorAll('.case-card'),
            stepIndicators: document.querySelectorAll('.step-indicator'),
            workshopSteps: document.querySelectorAll('.workshop-step'),
            nextBtns: document.querySelectorAll('.next-btn'),
            prevBtns: document.querySelectorAll('.prev-btn')
        };

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            setupEventListeners();
            setupChart();
            disableAIButtons();
        }

        function setupEventListeners() {
            // API 키 관련
            elements.apiKeyBtn?.addEventListener('click', () => showModal());
            elements.apiCancelBtn?.addEventListener('click', () => hideModal());
            elements.apiSaveBtn?.addEventListener('click', () => saveApiKey());
            elements.apiModal?.addEventListener('click', (e) => {
                if (e.target === elements.apiModal) hideModal();
            });

            // 네비게이션
            elements.navButtons.forEach(btn => {
                btn.addEventListener('click', () => switchSection(btn.dataset.target));
            });

            // 케이스 카드 뒤집기
            elements.caseCards.forEach(card => {
                card.addEventListener('click', () => card.classList.toggle('flipped'));
            });

            // 워크샵 단계 네비게이션
            elements.stepIndicators.forEach((indicator, index) => {
                indicator.addEventListener('click', () => goToStep(index));
            });

            elements.nextBtns.forEach(btn => {
                btn.addEventListener('click', () => nextStep());
            });

            elements.prevBtns.forEach(btn => {
                btn.addEventListener('click', () => prevStep());
            });

            // AI 기능 버튼들
            setupAIButtons();

            // 완료 및 리셋 버튼
            document.getElementById('complete-btn')?.addEventListener('click', () => completeWorkshop());
            document.getElementById('reset-btn')?.addEventListener('click', () => resetWorkshop());
            document.getElementById('download-btn')?.addEventListener('click', () => downloadPlan());
        }

        function setupAIButtons() {
            const aiButtons = [
                { id: 'suggest-ideas-btn', handler: suggestIdeas },
                { id: 'suggest-objectives-btn', handler: suggestObjectives },
                { id: 'suggest-activities-btn', handler: suggestActivities },
                { id: 'suggest-expansion-btn', handler: suggestExpansion }
            ];

            aiButtons.forEach(({ id, handler }) => {
                const btn = document.getElementById(id);
                if (btn) btn.addEventListener('click', handler);
            });
        }

        // API 키 관리
        function showModal() {
            elements.apiModal?.classList.remove('hidden');
            elements.apiKeyInput?.focus();
        }

        function hideModal() {
            elements.apiModal?.classList.add('hidden');
            if (elements.apiKeyInput) elements.apiKeyInput.value = '';
        }

        function saveApiKey() {
            const key = elements.apiKeyInput?.value.trim();
            if (!key || key.length < 20 || !key.startsWith('AIza')) {
                showStatus('올바른 API 키를 입력해주세요.', 'error');
                return;
            }

            apiKey = key;
            hideModal();
            
            // UI 업데이트
            elements.apiKeyBtn?.classList.add('active');
            elements.apiStatusBanner.innerHTML = '✅ API 키가 설정되었습니다. 이제 AI 추천 기능을 사용할 수 있습니다.';
            elements.apiStatusBanner.className = 'mt-4 p-3 rounded-lg bg-green-50 border border-green-200 text-green-800 text-sm';
            
            enableAIButtons();
        }

        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('api-status');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.className = `text-sm ${type === 'error' ? 'text-red-600' : 'text-gray-600'}`;
            }
        }

        // AI 버튼 활성화/비활성화
        function enableAIButtons() {
            const aiButtons = document.querySelectorAll('[id*="suggest-"]');
            aiButtons.forEach(btn => {
                btn.disabled = false;
                btn.classList.remove('opacity-50');
            });
        }

        function disableAIButtons() {
            const aiButtons = document.querySelectorAll('[id*="suggest-"]');
            aiButtons.forEach(btn => {
                btn.disabled = true;
                btn.classList.add('opacity-50');
            });
        }

        // 차트 설정
        function setupChart() {
            const canvas = document.getElementById('caseTypeChart');
            if (!canvas) return;

            try {
                const ctx = canvas.getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['공공미술 프로젝트', '장소 탐방 & 재해석', '전문가 협력', '지역 문화유산 재해석', '생태 미술 프로젝트'],
                        datasets: [{
                            data: [25, 20, 20, 20, 15],
                            backgroundColor: [
                                'rgba(74, 144, 226, 0.7)',
                                'rgba(80, 227, 194, 0.7)',
                                'rgba(186, 104, 200, 0.7)',
                                'rgba(255, 159, 64, 0.7)',
                                'rgba(75, 192, 192, 0.7)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: { display: true, text: '지역연계 교육 사례 유형 분포' }
                        }
                    }
                });
            } catch (error) {
                console.error('차트 초기화 실패:', error);
            }
        }

        // 섹션 전환
        function switchSection(targetId) {
            elements.navButtons.forEach(btn => btn.classList.remove('active'));
            elements.contentSections.forEach(section => section.classList.add('hidden'));

            const targetBtn = document.querySelector(`[data-target="${targetId}"]`);
            const targetSection = document.getElementById(targetId);

            if (targetBtn) targetBtn.classList.add('active');
            if (targetSection) targetSection.classList.remove('hidden');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 워크샵 단계 관리
        function goToStep(stepIndex) {
            if (stepIndex < 0 || stepIndex > 3) return;
            
            saveCurrentStepData();
            currentStep = stepIndex;
            updateStepView();
        }

        function nextStep() {
            if (currentStep < 3) {
                saveCurrentStepData();
                currentStep++;
                updateStepView();
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                saveCurrentStepData();
                currentStep--;
                updateStepView();
            }
        }

        function updateStepView() {
            // 단계 표시기 업데이트
            elements.stepIndicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index === currentStep);
            });

            // 단계 컨텐츠 업데이트
            elements.workshopSteps.forEach((step, index) => {
                step.classList.toggle('hidden', index !== currentStep);
            });

            // 데이터 로드
            loadStepData();
        }

        function saveCurrentStepData() {
            switch (currentStep) {
                case 0:
                    workshopData.grade = document.getElementById('grade-select')?.value || '';
                    workshopData.resource = document.getElementById('resource-input')?.value || '';
                    break;
                case 1:
                    workshopData.competencies = Array.from(document.querySelectorAll('input[name="competency"]:checked'))
                        .map(cb => cb.value);
                    workshopData.topic = document.getElementById('topic-input')?.value || '';
                    workshopData.objectives = document.getElementById('objectives-input')?.value || '';
                    break;
                case 2:
                    workshopData.intro = document.getElementById('intro-input')?.value || '';
                    workshopData.main = document.getElementById('main-input')?.value || '';
                    workshopData.wrap = document.getElementById('wrap-input')?.value || '';
                    break;
                case 3:
                    workshopData.effects = document.getElementById('effects-input')?.value || '';
                    workshopData.expansion = document.getElementById('expansion-input')?.value || '';
                    break;
            }
        }

        function loadStepData() {
            switch (currentStep) {
                case 0:
                    if (document.getElementById('grade-select')) {
                        document.getElementById('grade-select').value = workshopData.grade;
                    }
                    if (document.getElementById('resource-input')) {
                        document.getElementById('resource-input').value = workshopData.resource;
                    }
                    break;
                case 1:
                    // 선택된 자원 표시
                    const selectedResourceEl = document.getElementById('selected-resource');
                    if (selectedResourceEl) {
                        selectedResourceEl.textContent = workshopData.resource || '입력된 자원 없음';
                    }
                    
                    // 역량 체크박스 복원
                    document.querySelectorAll('input[name="competency"]').forEach(cb => {
                        cb.checked = workshopData.competencies.includes(cb.value);
                    });
                    
                    if (document.getElementById('topic-input')) {
                        document.getElementById('topic-input').value = workshopData.topic;
                    }
                    if (document.getElementById('objectives-input')) {
                        document.getElementById('objectives-input').value = workshopData.objectives;
                    }
                    break;
                case 2:
                    if (document.getElementById('intro-input')) {
                        document.getElementById('intro-input').value = workshopData.intro;
                    }
                    if (document.getElementById('main-input')) {
                        document.getElementById('main-input').value = workshopData.main;
                    }
                    if (document.getElementById('wrap-input')) {
                        document.getElementById('wrap-input').value = workshopData.wrap;
                    }
                    break;
                case 3:
                    if (document.getElementById('effects-input')) {
                        document.getElementById('effects-input').value = workshopData.effects;
                    }
                    if (document.getElementById('expansion-input')) {
                        document.getElementById('expansion-input').value = workshopData.expansion;
                    }
                    break;
            }
        }

        // AI 기능들
        async function callGeminiAPI(prompt, outputElementId, spinnerId) {
            if (!apiKey) {
                showOutput(outputElementId, '<p class="text-red-600">API 키를 먼저 설정해주세요.</p>');
                return;
            }

            const spinner = document.getElementById(spinnerId);
            const output = document.getElementById(outputElementId);

            if (spinner) spinner.classList.remove('hidden');
            if (output) output.classList.add('hidden');

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 1024
                        }
                    })
                });

                if (!response.ok) throw new Error(`API 오류: ${response.status}`);

                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (text) {
                    showOutput(outputElementId, `<h4 class="font-bold mb-2">✨ AI 제안:</h4><div>${formatAIResponse(text)}</div>`);
                } else {
                    showOutput(outputElementId, '<p class="text-red-600">응답을 생성할 수 없습니다.</p>');
                }
            } catch (error) {
                console.error('API 호출 실패:', error);
                showOutput(outputElementId, `<p class="text-red-600">오류가 발생했습니다: ${error.message}</p>`);
            } finally {
                if (spinner) spinner.classList.add('hidden');
            }
        }

        function showOutput(elementId, content) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = content;
                element.classList.remove('hidden');
            }
        }

        function formatAIResponse(text) {
            return text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        }

        async function suggestIdeas() {
            const grade = document.getElementById('grade-select')?.value;
            const resource = document.getElementById('resource-input')?.value;

            if (!grade || !resource) {
                showOutput('suggested-ideas-output', '<p class="text-red-600">학년과 지역 자원을 모두 입력해주세요.</p>');
                return;
            }

            const prompt = `초등학교 ${grade} 학생들이 '${resource}' 자원을 활용한 창의적인 미술 활동 아이디어 3가지를 제안해주세요.`;
            await callGeminiAPI(prompt, 'suggested-ideas-output', 'suggest-ideas-spinner');
        }

        async function suggestObjectives() {
            const grade = workshopData.grade;
            const resource = workshopData.resource;
            const topic = document.getElementById('topic-input')?.value;

            if (!grade || !resource || !topic) {
                showOutput('suggested-objectives-output', '<p class="text-red-600">필수 정보를 모두 입력해주세요.</p>');
                return;
            }

            const prompt = `초등학교 ${grade} 학생들이 '${resource}' 자원을 활용하여 '${topic}' 주제로 미술 수업을 할 때의 구체적인 학습 목표 3가지를 제안해주세요.`;
            await callGeminiAPI(prompt, 'suggested-objectives-output', 'suggest-objectives-spinner');
        }

        async function suggestActivities() {
            const grade = workshopData.grade;
            const topic = workshopData.topic;
            const objectives = workshopData.objectives;

            if (!grade || !topic || !objectives) {
                showOutput('suggested-activities-output', '<p class="text-red-600">필수 정보를 모두 입력해주세요.</p>');
                return;
            }

            const prompt = `초등학교 ${grade} 학생들이 '${topic}' 주제로 미술 수업을 할 때, 도입-전개-정리 단계별 구체적인 활동 아이디어를 제안해주세요.`;
            await callGeminiAPI(prompt, 'suggested-activities-output', 'suggest-activities-spinner');
        }

        async function suggestExpansion() {
            const grade = workshopData.grade;
            const topic = workshopData.topic;
            const effects = document.getElementById('effects-input')?.value;

            if (!grade || !topic || !effects) {
                showOutput('suggested-expansion-output', '<p class="text-red-600">필수 정보를 모두 입력해주세요.</p>');
                return;
            }

            const prompt = `초등학교 ${grade}의 '${topic}' 미술 수업을 다른 교과나 활동으로 확장할 수 있는 방안을 3가지 제안해주세요.`;
            await callGeminiAPI(prompt, 'suggested-expansion-output', 'suggest-expansion-spinner');
        }

        // 워크샵 완료
        function completeWorkshop() {
            saveCurrentStepData();
            
            // 요약 생성
            const summary = generateSummary();
            document.getElementById('summary-content').innerHTML = summary;
            
            // 완료 뷰 표시
            elements.workshopSteps.forEach(step => step.classList.add('hidden'));
            document.getElementById('complete-view')?.classList.remove('hidden');
        }

        function generateSummary() {
            return `
                <p><strong>학년:</strong> ${workshopData.grade || '미입력'}</p>
                <p><strong>동네 자원:</strong> ${workshopData.resource || '미입력'}</p>
                <p><strong>핵심 역량:</strong> ${workshopData.competencies.join(', ') || '미선택'}</p>
                <p><strong>학습 주제:</strong> ${workshopData.topic || '미입력'}</p>
                <p><strong>학습 목표:</strong> ${workshopData.objectives || '미입력'}</p>
                <p><strong>도입 활동:</strong> ${workshopData.intro || '미입력'}</p>
                <p><strong>전개 활동:</strong> ${workshopData.main || '미입력'}</p>
                <p><strong>정리 활동:</strong> ${workshopData.wrap || '미입력'}</p>
                <p><strong>기대 효과:</strong> ${workshopData.effects || '미입력'}</p>
                <p><strong>확장 방안:</strong> ${workshopData.expansion || '미입력'}</p>
            `;
        }

        // 초기화
        function resetWorkshop() {
            if (!confirm('모든 입력 내용이 삭제됩니다. 계속하시겠습니까?')) return;

            // 데이터 초기화
            Object.keys(workshopData).forEach(key => {
                workshopData[key] = Array.isArray(workshopData[key]) ? [] : '';
            });

            // 입력 필드 초기화
            document.querySelectorAll('input, textarea, select').forEach(el => {
                if (el.type === 'checkbox') el.checked = false;
                else el.value = '';
            });

            // AI 출력 숨기기
            document.querySelectorAll('[id$="-output"]').forEach(el => {
                el.classList.add('hidden');
            });

            // 첫 단계로 이동
            currentStep = 0;
            updateStepView();
            
            // 완료 뷰 숨기기
            document.getElementById('complete-view')?.classList.add('hidden');
        }

        // 다운로드
        function downloadPlan() {
            const content = generateHTMLContent();
            const blob = new Blob([content], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `미술수업계획안_${new Date().toISOString().slice(0, 10)}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function generateHTMLContent() {
            return `
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <title>미술 수업 계획안</title>
                    <style>
                        body { font-family: 'Noto Sans KR', sans-serif; margin: 20px; line-height: 1.6; }
                        h1 { color: #2C3E50; text-align: center; margin-bottom: 30px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; vertical-align: top; }
                        th { background-color: #f0f4f8; font-weight: bold; width: 25%; }
                    </style>
                </head>
                <body>
                    <h1>미술 수업 계획안</h1>
                    <table>
                        <tr><th>학년</th><td>${workshopData.grade}</td></tr>
                        <tr><th>동네 자원</th><td>${workshopData.resource}</td></tr>
                        <tr><th>핵심 역량</th><td>${workshopData.competencies.join(', ')}</td></tr>
                        <tr><th>학습 주제</th><td>${workshopData.topic}</td></tr>
                        <tr><th>학습 목표</th><td>${workshopData.objectives.replace(/\n/g, '<br>')}</td></tr>
                        <tr><th>도입 활동</th><td>${workshopData.intro.replace(/\n/g, '<br>')}</td></tr>
                        <tr><th>전개 활동</th><td>${workshopData.main.replace(/\n/g, '<br>')}</td></tr>
                        <tr><th>정리 활동</th><td>${workshopData.wrap.replace(/\n/g, '<br>')}</td></tr>
                        <tr><th>기대 효과</th><td>${workshopData.effects.replace(/\n/g, '<br>')}</td></tr>
                        <tr><th>확장 방안</th><td>${workshopData.expansion.replace(/\n/g, '<br>')}</td></tr>
                    </table>
                </body>
                </html>
            `;
        }
    </script>
</body>
</html>
