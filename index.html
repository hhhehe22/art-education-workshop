<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>미술교과 기반 지역연계 학교예술교육 워크숍</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #F9F9F7;
            color: #333333;
        }
        .section-card {
            background-color: #FFFFFF;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border: 1px solid #EDEDED;
        }
        .nav-button {
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
        }
        .nav-button.active {
            color: #4A90E2;
            border-bottom-color: #4A90E2;
        }
        .nav-button:hover {
            color: #4A90E2;
            background-color: #F0F5FA;
        }
        .case-card {
            perspective: 1000px;
        }
        .case-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .case-card.flipped .case-card-inner {
            transform: rotateY(180deg);
        }
        .case-card-front, .case-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 0.75rem;
            padding: 1.5rem;
        }
        .case-card-front {
            background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
            color: #334155;
        }
        .case-card-back {
            background-color: #ffffff;
            border: 1px solid #e2e8f0;
            transform: rotateY(180deg);
            overflow-y: auto;
            align-items: flex-start;
        }
        .step-indicator {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .step-indicator.active {
            background-color: #4A90E2;
            color: white;
            transform: scale(1.1);
        }
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.5rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #4A90E2;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal.hidden {
            display: none;
        }
        .api-key-button {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background-color: #4A90E2;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        .api-key-button:hover {
            background-color: #357ABD;
            transform: scale(1.1);
        }
        .api-key-button.active {
            background-color: #10B981;
        }
    </style>
</head>
<body>
    <!-- API 키 설정 버튼 -->
    <button id="api-key-btn" class="api-key-button" title="API 키 설정">🔑</button>

    <!-- API 키 설정 모달 -->
    <div id="api-modal" class="modal hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full mx-4">
            <h3 class="text-xl font-bold text-gray-800 mb-4">🔑 Gemini API 키 설정</h3>
            
            <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
                <h4 class="font-bold text-blue-800 mb-2">📋 API 키 발급 방법</h4>
                <ol class="text-sm text-blue-700 space-y-1 list-decimal list-inside">
                    <li><a href="https://aistudio.google.com/app/apikey" target="_blank" class="underline hover:text-blue-900">Google AI Studio</a>에 접속</li>
                    <li>"Create API Key" 버튼 클릭</li>
                    <li>생성된 API 키를 아래에 입력</li>
                </ol>
            </div>
            
            <div class="space-y-4">
                <input type="password" id="api-key-input" class="form-input" placeholder="Gemini API 키를 입력하세요 (예: AIzaSy...)">
                <div id="api-status" class="text-sm text-gray-600">API 키를 입력하면 AI 추천 기능을 사용할 수 있습니다.</div>
                <div class="flex space-x-3">
                    <button id="api-save-btn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg">저장</button>
                    <button id="api-cancel-btn" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">취소</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800">미술교과 기반 지역연계 학교예술교육</h1>
            <p class="text-lg text-gray-500 mt-4">초등 교원을 위한 실습 중심 워크숍</p>
            
            <!-- API 상태 표시 -->
            <div id="api-status-banner" class="mt-4 p-3 rounded-lg bg-yellow-50 border border-yellow-200 text-yellow-800 text-sm">
                ⚠️ AI 기능을 사용하려면 우측 상단의 🔑 버튼을 클릭하여 API 키를 설정해주세요.
            </div>
        </header>

        <nav class="sticky top-0 bg-white/80 backdrop-blur-sm z-10 shadow-sm rounded-lg mb-12">
            <div class="max-w-5xl mx-auto px-4">
                <div class="flex justify-center space-x-2 md:space-x-8">
                    <button data-target="intro" class="nav-button active font-semibold py-4 px-2 md:px-4 text-sm md:text-base">⏰ 연수 시작</button>
                    <button data-target="cases" class="nav-button font-semibold py-4 px-2 md:px-4 text-sm md:text-base">🎨 사례 탐구</button>
                    <button data-target="workshop" class="nav-button font-semibold py-4 px-2 md:px-4 text-sm md:text-base">💡 수업 설계</button>
                    <button data-target="wrapup" class="nav-button font-semibold py-4 px-2 md:px-4 text-sm md:text-base">📝 정리 및 공유</button>
                </div>
            </div>
        </nav>

        <main id="content-container">
            <!-- 연수 시작 섹션 -->
            <section id="intro" class="content-section">
                <div class="max-w-4xl mx-auto section-card p-8 md:p-12">
                    <h2 class="text-3xl font-bold mb-6 text-gray-800">🚀 함께 시작하기: 우리 동네 보물찾기</h2>
                    <p class="text-gray-600 mb-8 leading-relaxed">
                        안녕하세요, 선생님! 이번 연수에 오신 것을 환영합니다. 이 시간은 이론 학습을 넘어, 선생님께서 직접 '지역사회'라는 살아있는 교육 자원을 활용하여 학생들을 위한 특별한 미술 수업을 기획하는 실습의 장입니다. 딱딱한 강의가 아닌, 동료 교사들과 함께 아이디어를 나누고 실제적인 결과물을 만들어가는 의미 있는 시간이 될 것입니다.
                    </p>
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg mb-8">
                        <h3 class="font-bold text-xl mb-2 text-blue-800">오늘의 연수 목표</h3>
                        <ul class="list-disc list-inside text-blue-700 space-y-2">
                            <li>지역연계 예술교육의 개념과 가치를 이해합니다.</li>
                            <li>다양한 성공 사례를 통해 아이디어를 얻습니다.</li>
                            <li>나만의 지역연계 미술 수업을 직접 설계하고 구체화합니다.</li>
                        </ul>
                    </div>
                    
                    <h3 class="font-bold text-2xl mb-4 text-gray-700">ICE-BREAKING: 우리 학교 1km 반경에는?</h3>
                    <p class="text-gray-600 mb-6">수업 설계를 시작하기 전, 잠시 우리 학교 주변을 떠올려볼까요? 학교에서 걸어갈 수 있는 거리 안에 학생들과 함께 탐색하고, 배우고, 영감을 얻을 수 있는 '보물'이 숨어있을지 모릅니다. 아래 키워드를 보며 생각나는 장소나 인물, 이야기를 자유롭게 떠올려보세요.</p>
                    <div class="flex flex-wrap gap-4 text-center">
                        <span class="bg-yellow-100 text-yellow-800 text-base font-medium px-4 py-2 rounded-full">🌳 공원/숲</span>
                        <span class="bg-green-100 text-green-800 text-base font-medium px-4 py-2 rounded-full">🏛️ 작은 박물관/미술관</span>
                        <span class="bg-indigo-100 text-indigo-800 text-base font-medium px-4 py-2 rounded-full">시장/상점가</span>
                        <span class="bg-purple-100 text-purple-800 text-base font-medium px-4 py-2 rounded-full">🧑‍🎨 지역 예술가/장인</span>
                        <span class="bg-pink-100 text-pink-800 text-base font-medium px-4 py-2 rounded-full">📜 오래된 건물/역사 유적</span>
                        <span class="bg-gray-200 text-gray-800 text-base font-medium px-4 py-2 rounded-full">🏢 공공기관 (주민센터, 도서관)</span>
                    </div>
                </div>
            </section>

            <!-- 사례 탐구 섹션 -->
            <section id="cases" class="content-section hidden">
                <div class="max-w-5xl mx-auto section-card p-8 md:p-12">
                    <h2 class="text-3xl font-bold mb-2 text-gray-800">🌍 가능성의 발견: 지역연계 교육 사례 탐구</h2>
                    <p class="text-gray-600 mb-8 leading-relaxed">
                        '지역연계 수업'이 막연하게 느껴지시나요? 이미 전국의 많은 학교에서 지역사회의 특성을 살린 창의적인 미술 교육을 실천하고 있습니다. 여기서는 몇 가지 대표적인 사례 유형을 소개해 드립니다. 각 카드를 클릭하여 자세한 내용을 살펴보시고, 우리 학교, 우리 지역에 적용할 수 있는 아이디어의 실마리를 찾아보세요.
                    </p>
                    
                    <div class="grid md:grid-cols-2 gap-8 mb-12">
                        <div class="chart-container relative h-[300px] md:h-auto md:max-h-[400px]">
                            <canvas id="caseTypeChart"></canvas>
                        </div>
                        <div class="flex flex-col justify-center">
                            <h3 class="font-bold text-2xl mb-4 text-gray-700">사례 유형 분석</h3>
                            <p class="text-gray-600">지역연계 수업은 다양한 형태로 이루어집니다. '공공미술 프로젝트'처럼 학생들이 직접 지역 환경 개선에 참여하는 형태가 가장 많으며, '장소 탐방'이나 '전문가 협력' 수업도 활발히 이루어지고 있습니다. 이는 학교 밖의 살아있는 자원을 활용하려는 노력이 다방면으로 시도되고 있음을 보여줍니다.</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="case-card h-64 cursor-pointer">
                            <div class="case-card-inner">
                                <div class="case-card-front">
                                    <h3 class="text-2xl font-bold">공공미술 프로젝트</h3>
                                    <p class="mt-2">우리 동네를 캔버스로!</p>
                                    <span class="mt-4 text-xs font-semibold">(클릭하여 자세히 보기)</span>
                                </div>
                                <div class="case-card-back text-left">
                                    <h4 class="font-bold text-lg mb-2">마을 벽화 그리기</h4>
                                    <p class="text-sm text-gray-600">
                                        <strong>- 대상:</strong> 5~6학년<br>
                                        <strong>- 연계자원:</strong> 지역 주민센터, 노후 담벼락<br>
                                        <strong>- 활동:</strong> 우리 동네 이야기 리서치 → 디자인 시안 제작 및 발표 → 주민 의견 수렴 → 함께 벽화 제작<br>
                                        <strong>- 성과:</strong> 환경 개선, 공동체 의식 함양
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="case-card h-64 cursor-pointer">
                            <div class="case-card-inner">
                                <div class="case-card-front">
                                    <h3 class="text-2xl font-bold">장소 탐방 & 재해석</h3>
                                    <p class="mt-2">익숙한 공간, 새롭게 보기</p>
                                    <span class="mt-4 text-xs font-semibold">(클릭하여 자세히 보기)</span>
                                </div>
                                <div class="case-card-back text-left">
                                    <h4 class="font-bold text-lg mb-2">전통시장 드로잉</h4>
                                    <p class="text-sm text-gray-600">
                                        <strong>- 대상:</strong> 3~4학년<br>
                                        <strong>- 연계자원:</strong> 지역 전통시장<br>
                                        <strong>- 활동:</strong> 시장 방문하여 오감으로 관찰하기 → 상인 인터뷰 및 사진 촬영 → 가장 인상 깊은 모습 드로잉/콜라주로 표현 → '우리 시장 전시회' 개최<br>
                                        <strong>- 성과:</strong> 관찰력, 표현력, 지역 경제 이해
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="case-card h-64 cursor-pointer">
                            <div class="case-card-inner">
                                <div class="case-card-front">
                                    <h3 class="text-2xl font-bold">전문가 협력 수업</h3>
                                    <p class="mt-2">마을 장인에게 한 수 배우기</p>
                                    <span class="mt-4 text-xs font-semibold">(클릭하여 자세히 보기)</span>
                                </div>
                                <div class="case-card-back text-left">
                                    <h4 class="font-bold text-lg mb-2">도예가와 함께하는 컵 만들기</h4>
                                    <p class="text-sm text-gray-600">
                                        <strong>- 대상:</strong> 전학년<br>
                                        <strong>- 연계자원:</strong> 지역 도예 공방 작가<br>
                                        <strong>- 활동:</strong> 작가 초빙하여 직업 이야기 듣기 → 흙의 성질 탐구 → 1인 1컵 디자인 및 제작 → 가마 소성 후 작품 감상<br>
                                        <strong>- 성과:</strong> 진로 탐색, 조형 능력, 재료 이해
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="case-card h-64 cursor-pointer">
                            <div class="case-card-inner">
                                <div class="case-card-front">
                                    <h3 class="text-2xl font-bold">지역 문화유산 재해석</h3>
                                    <p class="mt-2">우리 지역의 숨겨진 이야기, 예술로 되살리기</p>
                                    <span class="mt-4 text-xs font-semibold">(클릭하여 자세히 보기)</span>
                                </div>
                                <div class="case-card-back text-left">
                                    <h4 class="font-bold text-lg mb-2">역사 속 인물 조형물 제작</h4>
                                    <p class="text-sm text-gray-600">
                                        <strong>- 대상:</strong> 4~6학년<br>
                                        <strong>- 연계자원:</strong> 지역 향토사료관, 문화유산 해설사<br>
                                        <strong>- 활동:</strong> 지역 문화유산 조사 및 답사 → 역사적 의미 탐구 → 현대적 재해석을 통한 조형물/미디어아트 제작 → 문화유산 현장에 설치 및 전시<br>
                                        <strong>- 성과:</strong> 지역 역사 이해, 창의적 재해석 능력, 문화유산 보존 인식
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="case-card h-64 cursor-pointer">
                            <div class="case-card-inner">
                                <div class="case-card-front">
                                    <h3 class="text-2xl font-bold">생태 미술 프로젝트</h3>
                                    <p class="mt-2">자연과 함께하는 예술, 환경을 지키는 미술</p>
                                    <span class="mt-4 text-xs font-semibold">(클릭하여 자세히 보기)</span>
                                </div>
                                <div class="case-card-back text-left">
                                    <h4 class="font-bold text-lg mb-2">폐품 활용 환경 설치미술</h4>
                                    <p class="text-sm text-gray-600">
                                        <strong>- 대상:</strong> 3~5학년<br>
                                        <strong>- 연계자원:</strong> 지역 환경 단체, 공원 관리 사무소<br>
                                        <strong>- 활동:</strong> 지역 생태 환경 조사 → 환경 문제 인식 및 토론 → 자연물/폐품을 활용한 설치미술/정크아트 제작 → 환경 캠페인 및 전시<br>
                                        <strong>- 성과:</strong> 환경 감수성 함양, 문제 해결 능력, 공동체 의식
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 수업 설계 섹션 -->
            <section id="workshop" class="content-section hidden">
                <div class="max-w-4xl mx-auto section-card p-8 md:p-12">
                    <h2 class="text-3xl font-bold mb-2 text-gray-800">🛠️ 나만의 수업 설계하기</h2>
                    <p class="text-gray-600 mb-8 leading-relaxed">
                        이제 본격적으로 선생님만의 지역연계 미술 수업을 구상할 시간입니다. 아래 4가지 단계를 따라가며 빈칸을 채워보세요. 정답은 없습니다. 자유롭게 아이디어를 기록하고 구체화하는 과정 자체가 중요합니다. 이 활동을 통해 연수가 끝날 때쯤, 선생님 손에는 멋진 수업 계획안의 초안이 들려있을 것입니다.
                    </p>

                    <div class="flex justify-around mb-8">
                        <div class="step-indicator w-16 h-16 flex items-center justify-center rounded-full border-2 border-gray-300 active" data-step="0">1단계</div>
                        <div class="step-indicator w-16 h-16 flex items-center justify-center rounded-full border-2 border-gray-300" data-step="1">2단계</div>
                        <div class="step-indicator w-16 h-16 flex items-center justify-center rounded-full border-2 border-gray-300" data-step="2">3단계</div>
                        <div class="step-indicator w-16 h-16 flex items-center justify-center rounded-full border-2 border-gray-300" data-step="3">4단계</div>
                    </div>
                    
                    <!-- 1단계: 자원 탐색 -->
                    <div id="step-0" class="workshop-step">
                        <h3 class="font-bold text-2xl mb-4 text-gray-700">1단계: 우리 동네 자원 탐색</h3>
                        <p class="text-gray-600 mb-6">우리 학교 주변에서 미술 수업과 연결할 수 있는 인적, 물적 자원은 무엇이 있을까요? (예: 행복 주민센터 옥상 텃밭, 학교 옆 공방 도예가, 우리 동네 지명의 유래가 담긴 설화)</p>
                        
                        <div class="mb-4">
                            <label for="grade-select" class="block text-gray-700 text-sm font-bold mb-2">학년 선택:</label>
                            <select id="grade-select" class="form-input">
                                <option value="">학년을 선택하세요</option>
                                <option value="1-2학년">1-2학년</option>
                                <option value="3-4학년">3-4학년</option>
                                <option value="5-6학년">5-6학년</option>
                            </select>
                        </div>
                        
                        <textarea id="resource-input" class="form-input" rows="4" placeholder="자유롭게 기록해보세요..."></textarea>
                        
                        <button id="suggest-ideas-btn" class="mt-4 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-6 rounded-lg flex items-center disabled:opacity-50">
                            <span id="suggest-ideas-spinner" class="loading-spinner mr-2 hidden"></span>
                            ✨ 아이디어 제안 받기
                        </button>
                        <div id="suggested-ideas-output" class="mt-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-indigo-800 hidden"></div>
                        
                        <div class="mt-6 flex justify-end">
                            <button class="next-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">다음 단계로</button>
                        </div>
                    </div>

                    <!-- 2단계: 교육과정 연결 -->
                    <div id="step-1" class="workshop-step hidden">
                        <h3 class="font-bold text-2xl mb-4 text-gray-700">2단계: 교육과정 연결 및 주제 정하기</h3>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">선택된 동네 자원:</label>
                            <p id="selected-resource" class="form-input bg-gray-100 text-gray-600"></p>
                        </div>

                        <div class="mb-6">
                            <label class="block text-gray-700 text-sm font-bold mb-2">핵심 역량:</label>
                            <p class="text-gray-500 text-xs mb-2">수업을 통해 함양하고자 하는 역량을 선택하세요.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                <label class="flex items-center">
                                    <input type="checkbox" name="competency" value="심미적 감성 역량" class="mr-2">
                                    <span class="text-gray-700">심미적 감성 역량</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="competency" value="시각적 소통 역량" class="mr-2">
                                    <span class="text-gray-700">시각적 소통 역량</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="competency" value="창의∙융합 역량" class="mr-2">
                                    <span class="text-gray-700">창의∙융합 역량</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="competency" value="미술문화 이해 역량" class="mr-2">
                                    <span class="text-gray-700">미술문화 이해 역량</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="competency" value="자기주도적 미술학습 역량" class="mr-2">
                                    <span class="text-gray-700">자기주도적 미술학습 역량</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="topic-input" class="block text-gray-700 text-sm font-bold mb-2">학습 주제:</label>
                            <textarea id="topic-input" class="form-input" rows="2" placeholder="수업 주제를 기록해보세요..."></textarea>
                            <button id="expand-topic-btn" class="mt-2 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg flex items-center disabled:opacity-50">
                                <span id="expand-topic-spinner" class="loading-spinner mr-2 hidden"></span>
                                ✨ 학습 주제 확장
                            </button>
                            <div id="expanded-topic-output" class="mt-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-indigo-800 hidden"></div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="objectives-input" class="block text-gray-700 text-sm font-bold mb-2">학습 목표:</label>
                            <p class="text-gray-500 text-xs mb-2">미술과 교육과정의 '내용 체계 및 성취기준'을 참고하여 구체적인 학습 목표를 작성해보세요.</p>
                            <textarea id="objectives-input" class="form-input" rows="4" placeholder="학습 목표를 구체적으로 작성해보세요..."></textarea>
                            <div class="flex justify-between items-center mt-4">
                                <button id="suggest-objectives-btn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-6 rounded-lg flex items-center disabled:opacity-50">
                                    <span id="suggest-objectives-spinner" class="loading-spinner mr-2 hidden"></span>
                                    ✨ 학습 목표 제안 받기
                                </button>
                                <a href="https://notebooklm.google.com/notebook/fdb22972-091a-42b6-bf37-54aeb1da1d09" target="_blank" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg text-center">2022개정교육과정 챗봇</a>
                            </div>
                            <div id="suggested-objectives-output" class="mt-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-indigo-800 hidden"></div>
                        </div>

                        <div class="mt-6 flex justify-between">
                            <button class="prev-btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg">이전 단계로</button>
                            <button class="next-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">다음 단계로</button>
                        </div>
                    </div>

                    <!-- 3단계: 활동 구체화 -->
                    <div id="step-2" class="workshop-step hidden">
                        <h3 class="font-bold text-2xl mb-4 text-gray-700">3단계: 활동 내용 구체화 (120분 기준)</h3>
                        <p class="text-gray-600 mb-6">수업의 흐름을 '도입-전개-정리'로 나누어 구체적인 활동을 설계해보세요. 학생들의 흥미를 어떻게 유발하고, 핵심 활동은 무엇이며, 마무리는 어떻게 할까요?</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label for="intro-input" class="block text-gray-700 text-sm font-bold mb-2">도입 활동:</label>
                                <textarea id="intro-input" class="form-input" rows="3" placeholder="흥미 유발, 동기 부여 활동..."></textarea>
                            </div>
                            
                            <div id="main-activities-container">
                                <!-- 동적으로 생성될 전개 활동들 -->
                            </div>
                            <button id="add-main-activity-btn" class="mt-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-1 px-3 rounded-lg text-sm">전개 칸 추가</button>
                            
                            <div>
                                <label for="wrap-input" class="block text-gray-700 text-sm font-bold mb-2 mt-4">정리 활동:</label>
                                <textarea id="wrap-input" class="form-input" rows="3" placeholder="작품 공유, 느낀 점 나누기, 차시 예고..."></textarea>
                            </div>
                        </div>

                        <button id="expand-learning-activity-btn" class="mt-4 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-6 rounded-lg flex items-center disabled:opacity-50">
                            <span id="expand-learning-activity-spinner" class="loading-spinner mr-2 hidden"></span>
                            ✨ 학습 활동 확장
                        </button>
                        <div id="expanded-learning-activity-output" class="mt-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-indigo-800 hidden"></div>

                        <h4 class="font-bold text-xl mt-8 mb-4 text-gray-700">활용할 자원</h4>
                        <p class="text-gray-600 mb-4">수업에 활용할 자원을 기록하거나 AI 추천을 받아보세요. 모든 칸을 채울 필요는 없습니다.</p>
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="border p-2 text-left">자원 유형</th>
                                    <th class="border p-2 text-left">활용할 자원과 방법</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="border p-2">인적 자원</td>
                                    <td class="border p-2">
                                        <textarea id="resource-human" class="form-input h-20" placeholder="예: 지역 예술가, 장인"></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="border p-2">물적 자원</td>
                                    <td class="border p-2">
                                        <textarea id="resource-material" class="form-input h-20" placeholder="예: 공원, 전통시장"></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="border p-2">정보, 문화 자원</td>
                                    <td class="border p-2">
                                        <textarea id="resource-info-culture" class="form-input h-20" placeholder="예: 지역 역사 자료, 설화"></textarea>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <button id="suggest-resources-btn" class="mt-4 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-6 rounded-lg flex items-center disabled:opacity-50">
                            <span id="suggest-resources-spinner" class="loading-spinner mr-2 hidden"></span>
                            ✨ 자원 추천 받기
                        </button>
                        <div id="suggested-resources-output" class="mt-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-indigo-800 hidden"></div>

                        <h4 class="font-bold text-xl mt-8 mb-4 text-gray-700">체험 활동</h4>
                        <p class="text-gray-600 mb-4">외부 체험 활동 아이디어를 기록하거나 AI 추천을 받아보세요.</p>
                        <textarea id="experience-input" class="form-input" rows="4" placeholder="추천받은 체험 활동 아이디어를 기록하거나 수정해보세요..."></textarea>
                        <button id="expand-experience-btn" class="mt-4 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-6 rounded-lg flex items-center disabled:opacity-50">
                            <span id="expand-experience-spinner" class="loading-spinner mr-2 hidden"></span>
                            ✨ 체험 활동 확장
                        </button>
                        <div id="expanded-experience-output" class="mt-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-indigo-800 hidden"></div>

                        <div class="mt-6 flex justify-between">
                            <button class="prev-btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg">이전 단계로</button>
                            <button class="next-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">다음 단계로</button>
                        </div>
                    </div>

                    <!-- 4단계: 기대 효과 -->
                    <div id="step-3" class="workshop-step hidden">
                        <h3 class="font-bold text-2xl mb-4 text-gray-700">4단계: 기대 효과 및 확장 방안</h3>
                        
                        <div class="mb-4">
                            <label for="effects-input" class="block text-gray-700 text-sm font-bold mb-2">기대 효과:</label>
                            <textarea id="effects-input" class="form-input" rows="4" placeholder="이 수업의 기대효과를 기록해보세요..." required></textarea>
                        </div>
                        
                        <div class="mb-4">
                            <label for="expansion-input" class="block text-gray-700 text-sm font-bold mb-2">확장 방안:</label>
                            <textarea id="expansion-input" class="form-input" rows="4" placeholder="수업의 확장 방안을 기록해보세요..."></textarea>
                            <button id="suggest-expansion-btn" class="mt-4 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-6 rounded-lg flex items-center disabled:opacity-50">
                                <span id="suggest-expansion-spinner" class="loading-spinner mr-2 hidden"></span>
                                ✨ 수업의 확장 방안 추천
                            </button>
                            <div id="suggested-expansion-output" class="mt-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-indigo-800 hidden"></div>
                        </div>

                        <div class="mt-6 flex justify-between">
                            <button class="prev-btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg">이전 단계로</button>
                            <button id="complete-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg">수업 설계 완료!</button>
                        </div>
                    </div>
                    
                    <!-- 완료 뷰 -->
                    <div id="complete-view" class="hidden mt-8 bg-gray-50 p-6 rounded-lg">
                        <h3 class="text-2xl font-bold text-center mb-6">🎉 나만의 수업 계획안 초안이 완성되었습니다!</h3>
                        <div id="summary-content" class="space-y-4 text-gray-700"></div>
                        <p class="text-center mt-6 text-sm text-gray-500">잠시 후 동료 선생님들과 이 내용을 바탕으로 자유롭게 이야기를 나눠보겠습니다.</p>
                        <div class="mt-6 flex justify-center space-x-4">
                            <button id="reset-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg">초기화</button>
                            <button id="save-document-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg">계획서 문서로 저장하기</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 정리 및 공유 섹션 -->
            <section id="wrapup" class="content-section hidden">
                <div class="max-w-4xl mx-auto section-card p-8 md:p-12">
                    <h2 class="text-3xl font-bold mb-6 text-gray-800">🌱 아이디어 공유 및 마무리</h2>
                    <p class="text-gray-600 mb-8 leading-relaxed">
                        모두 수고하셨습니다. 짧은 시간이지만 선생님들께서 만들어주신 수업 계획의 초안들은 정말 소중한 결과물입니다. 이제 동료 선생님들과 자유롭게 아이디어를 공유하며 서로에게 영감을 주는 시간을 갖겠습니다.
                    </p>
                    
                    <div class="bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg mb-8">
                        <h3 class="font-bold text-xl mb-2 text-green-800">토의 주제</h3>
                        <ul class="list-disc list-inside text-green-700 space-y-2">
                            <li>가장 인상 깊었던 동료 선생님의 수업 아이디어는 무엇인가요?</li>
                            <li>수업을 실행할 때 예상되는 어려움과 해결 방안은 무엇일까요?</li>
                            <li>우리 지역의 숨겨진 예술 자원에는 또 무엇이 있을까요?</li>
                            <li>디지털 매체를 활용한 미술 수업 아이디어를 더 발전시키려면?</li>
                            <li>학생들의 예술적 감수성을 높이기 위한 교사의 역할은?</li>
                        </ul>
                    </div>

                    <h3 class="font-bold text-2xl mb-4 text-gray-700">자주 묻는 질문 (FAQ)</h3>
                    <div class="space-y-4">
                        <details class="group">
                            <summary class="flex items-center justify-between cursor-pointer p-4 bg-gray-100 rounded-lg font-semibold">
                                <span>지역의 예술가나 전문가 섭외는 어떻게 하나요?</span>
                                <span class="transform transition-transform duration-300 group-open:rotate-180">▼</span>
                            </summary>
                            <div class="p-4 bg-white rounded-b-lg border border-t-0">
                                <p>가장 좋은 방법은 지역 문화재단이나 교육청의 예술교육 지원 플랫폼을 활용하는 것입니다. '학교예술강사 지원사업' 등을 통해 검증된 전문가를 연결해 주기도 합니다.</p>
                            </div>
                        </details>
                        <details class="group">
                            <summary class="flex items-center justify-between cursor-pointer p-4 bg-gray-100 rounded-lg font-semibold">
                                <span>안전 문제가 걱정돼요. 현장 체험 시 유의할 점은?</span>
                                <span class="transform transition-transform duration-300 group-open:rotate-180">▼</span>
                            </summary>
                            <div class="p-4 bg-white rounded-b-lg border border-t-0">
                                <p>가장 중요한 것은 '사전 답사'입니다. 교사가 먼저 현장을 방문하여 위험 요소를 파악하고 동선을 계획해야 합니다.</p>
                            </div>
                        </details>
                    </div>

                    <p class="text-gray-700 mt-8 leading-relaxed text-center text-lg font-semibold">
                        오늘 연수에 참여해주셔서 진심으로 감사합니다. 선생님들의 열정과 창의적인 아이디어가 우리 아이들의 예술적 성장에 큰 밑거름이 될 것입니다!
                    </p>
                </div>
            </section>
        </main>

        <footer class="mt-12 py-6 text-center text-gray-500 text-sm border-t border-gray-200">
            <p>&copy; Copyright Yang Inseon. All rights reserved.</p>
            <p class="mt-2">본 코드는 수업 설계 및 활용을 위한 목적으로 제공됩니다. 제작자 정보의 무단 변경 및 코드의 상업적 배포는 삼가 주시기 바랍니다.</p>
        </footer>
    </div>

    <script>
        // 전역 변수
        let currentStep = 0;
        let apiKey = '';
        
        // 워크샵 데이터 저장 객체
        const workshopData = {
            grade: '',
            resource: '',
            competencies: [],
            topic: '',
            objectives: '',
            intro: '',
            mainActivities: [{ content: '' }],
            wrap: '',
            resourceTable: {
                human: '',
                material: '',
                infoCulture: ''
            },
            experience: '',
            effects: '',
            expansion: ''
        };

        // DOM 로드 완료 후 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            setupEventListeners();
            setupChart();
            disableAIButtons();
            renderMainActivities();
            console.log('애플리케이션이 초기화되었습니다.');
        }

        function setupEventListeners() {
            // API 키 관련 이벤트
            const apiKeyBtn = document.getElementById('api-key-btn');
            const apiModal = document.getElementById('api-modal');
            const apiKeyInput = document.getElementById('api-key-input');
            const apiSaveBtn = document.getElementById('api-save-btn');
            const apiCancelBtn = document.getElementById('api-cancel-btn');

            if (apiKeyBtn) apiKeyBtn.addEventListener('click', () => showModal());
            if (apiCancelBtn) apiCancelBtn.addEventListener('click', () => hideModal());
            if (apiSaveBtn) apiSaveBtn.addEventListener('click', () => saveApiKey());
            if (apiModal) {
                apiModal.addEventListener('click', (e) => {
                    if (e.target === apiModal) hideModal();
                });
            }

            // 네비게이션 버튼들
            const navButtons = document.querySelectorAll('.nav-button');
            navButtons.forEach(btn => {
                btn.addEventListener('click', () => switchSection(btn.dataset.target));
            });

            // 케이스 카드 뒤집기
            const caseCards = document.querySelectorAll('.case-card');
            caseCards.forEach(card => {
                card.addEventListener('click', () => card.classList.toggle('flipped'));
            });

            // 워크샵 단계 네비게이션
            const stepIndicators = document.querySelectorAll('.step-indicator');
            stepIndicators.forEach((indicator, index) => {
                indicator.addEventListener('click', () => goToStep(index));
            });

            // 다음/이전 버튼들
            const nextBtns = document.querySelectorAll('.next-btn');
            const prevBtns = document.querySelectorAll('.prev-btn');
            
            nextBtns.forEach(btn => {
                btn.addEventListener('click', () => nextStep());
            });

            prevBtns.forEach(btn => {
                btn.addEventListener('click', () => prevStep());
            });

            // 메인 활동 추가 버튼
            const addMainActivityBtn = document.getElementById('add-main-activity-btn');
            if (addMainActivityBtn) {
                addMainActivityBtn.addEventListener('click', () => addMainActivity());
            }

            // AI 기능 버튼들
            setupAIButtons();

            // 완료 및 리셋 버튼
            const completeBtn = document.getElementById('complete-btn');
            const resetBtn = document.getElementById('reset-btn');
            const saveDocumentBtn = document.getElementById('save-document-btn');

            if (completeBtn) completeBtn.addEventListener('click', () => completeWorkshop());
            if (resetBtn) resetBtn.addEventListener('click', () => resetWorkshop());
            if (saveDocumentBtn) saveDocumentBtn.addEventListener('click', () => saveDocument());
        }

        function setupAIButtons() {
            const aiButtons = [
                { id: 'suggest-ideas-btn', handler: suggestIdeas },
                { id: 'expand-topic-btn', handler: expandTopic },
                { id: 'suggest-objectives-btn', handler: suggestObjectives },
                { id: 'expand-learning-activity-btn', handler: expandLearningActivity },
                { id: 'suggest-resources-btn', handler: suggestResources },
                { id: 'expand-experience-btn', handler: expandExperience },
                { id: 'suggest-expansion-btn', handler: suggestExpansion }
            ];

            aiButtons.forEach(({ id, handler }) => {
                const btn = document.getElementById(id);
                if (btn) btn.addEventListener('click', handler);
            });
        }

        // API 키 관리
        function showModal() {
            const apiModal = document.getElementById('api-modal');
            const apiKeyInput = document.getElementById('api-key-input');
            
            if (apiModal) apiModal.classList.remove('hidden');
            if (apiKeyInput) apiKeyInput.focus();
        }

        function hideModal() {
            const apiModal = document.getElementById('api-modal');
            const apiKeyInput = document.getElementById('api-key-input');
            
            if (apiModal) apiModal.classList.add('hidden');
            if (apiKeyInput) apiKeyInput.value = '';
        }

        function saveApiKey() {
            const apiKeyInput = document.getElementById('api-key-input');
            const key = apiKeyInput?.value.trim();
            
            if (!key || key.length < 20 || !key.startsWith('AIza')) {
                showStatus('올바른 API 키를 입력해주세요. (AIza로 시작하는 39자리)', 'error');
                return;
            }

            apiKey = key;
            hideModal();
            
            // UI 업데이트
            const apiKeyBtn = document.getElementById('api-key-btn');
            const apiStatusBanner = document.getElementById('api-status-banner');
            
            if (apiKeyBtn) apiKeyBtn.classList.add('active');
            if (apiStatusBanner) {
                apiStatusBanner.innerHTML = '✅ API 키가 설정되었습니다. 이제 AI 추천 기능을 사용할 수 있습니다.';
                apiStatusBanner.className = 'mt-4 p-3 rounded-lg bg-green-50 border border-green-200 text-green-800 text-sm';
            }
            
            enableAIButtons();
            console.log('API 키가 성공적으로 설정되었습니다.');
        }

        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('api-status');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.className = `text-sm ${type === 'error' ? 'text-red-600' : 'text-gray-600'}`;
            }
        }

        // AI 버튼 활성화/비활성화
        function enableAIButtons() {
            const aiButtons = document.querySelectorAll('[id*="suggest-"], [id*="expand-"]');
            aiButtons.forEach(btn => {
                if (btn) {
                    btn.disabled = false;
                    btn.classList.remove('opacity-50');
                }
            });
        }

        function disableAIButtons() {
            const aiButtons = document.querySelectorAll('[id*="suggest-"], [id*="expand-"]');
            aiButtons.forEach(btn => {
                if (btn) {
                    btn.disabled = true;
                    btn.classList.add('opacity-50');
                }
            });
        }

        // 차트 설정
        function setupChart() {
            const canvas = document.getElementById('caseTypeChart');
            if (!canvas) return;

            try {
                const ctx = canvas.getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['공공미술 프로젝트', '장소 탐방 & 재해석', '전문가 협력', '지역 문화유산 재해석', '생태 미술 프로젝트'],
                        datasets: [{
                            data: [25, 20, 20, 20, 15],
                            backgroundColor: [
                                'rgba(74, 144, 226, 0.7)',
                                'rgba(80, 227, 194, 0.7)',
                                'rgba(186, 104, 200, 0.7)',
                                'rgba(255, 159, 64, 0.7)',
                                'rgba(75, 192, 192, 0.7)'
                            ],
                            borderColor: [
                                '#4A90E2',
                                '#50E3C2',
                                '#BA68C8',
                                '#FF9F40',
                                '#4BC0C0'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' },
                            title: { display: true, text: '지역연계 교육 사례 유형 분포' }
                        }
                    }
                });
            } catch (error) {
                console.error('차트 초기화 실패:', error);
            }
        }

        // 섹션 전환
        function switchSection(targetId) {
            const navButtons = document.querySelectorAll('.nav-button');
            const contentSections = document.querySelectorAll('.content-section');

            navButtons.forEach(btn => btn.classList.remove('active'));
            contentSections.forEach(section => section.classList.add('hidden'));

            const targetBtn = document.querySelector(`[data-target="${targetId}"]`);
            const targetSection = document.getElementById(targetId);

            if (targetBtn) targetBtn.classList.add('active');
            if (targetSection) targetSection.classList.remove('hidden');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 워크샵 단계 관리
        function goToStep(stepIndex) {
            if (stepIndex < 0 || stepIndex > 3) return;
            
            saveCurrentStepData();
            currentStep = stepIndex;
            updateStepView();
        }

        function nextStep() {
            if (currentStep < 3) {
                saveCurrentStepData();
                currentStep++;
                updateStepView();
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                saveCurrentStepData();
                currentStep--;
                updateStepView();
            }
        }

        function updateStepView() {
            // 단계 표시기 업데이트
            const stepIndicators = document.querySelectorAll('.step-indicator');
            stepIndicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index === currentStep);
            });

            // 단계 컨텐츠 업데이트
            const workshopSteps = document.querySelectorAll('.workshop-step');
            workshopSteps.forEach((step, index) => {
                step.classList.toggle('hidden', index !== currentStep);
            });

            // 데이터 로드
            loadStepData();
        }

        function saveCurrentStepData() {
            switch (currentStep) {
                case 0:
                    const gradeSelect = document.getElementById('grade-select');
                    const resourceInput = document.getElementById('resource-input');
                    
                    workshopData.grade = gradeSelect?.value || '';
                    workshopData.resource = resourceInput?.value || '';
                    break;
                    
                case 1:
                    const competencyBoxes = document.querySelectorAll('input[name="competency"]:checked');
                    const topicInput = document.getElementById('topic-input');
                    const objectivesInput = document.getElementById('objectives-input');
                    
                    workshopData.competencies = Array.from(competencyBoxes).map(cb => cb.value);
                    workshopData.topic = topicInput?.value || '';
                    workshopData.objectives = objectivesInput?.value || '';
                    break;
                    
                case 2:
                    const introInput = document.getElementById('intro-input');
                    const wrapInput = document.getElementById('wrap-input');
                    const resourceHuman = document.getElementById('resource-human');
                    const resourceMaterial = document.getElementById('resource-material');
                    const resourceInfoCulture = document.getElementById('resource-info-culture');
                    const experienceInput = document.getElementById('experience-input');
                    
                    workshopData.intro = introInput?.value || '';
                    workshopData.wrap = wrapInput?.value || '';
                    workshopData.resourceTable.human = resourceHuman?.value || '';
                    workshopData.resourceTable.material = resourceMaterial?.value || '';
                    workshopData.resourceTable.infoCulture = resourceInfoCulture?.value || '';
                    workshopData.experience = experienceInput?.value || '';
                    
                    // 메인 활동들 저장
                    workshopData.mainActivities = [];
                    const mainActivityInputs = document.querySelectorAll('[id^="main-activity-"]');
                    mainActivityInputs.forEach(input => {
                        workshopData.mainActivities.push({ content: input.value });
                    });
                    
                    if (workshopData.mainActivities.length === 0) {
                        workshopData.mainActivities = [{ content: '' }];
                    }
                    break;
                    
                case 3:
                    const effectsInput = document.getElementById('effects-input');
                    const expansionInput = document.getElementById('expansion-input');
                    
                    workshopData.effects = effectsInput?.value || '';
                    workshopData.expansion = expansionInput?.value || '';
                    break;
            }
        }

        function loadStepData() {
            switch (currentStep) {
                case 0:
                    const gradeSelect = document.getElementById('grade-select');
                    const resourceInput = document.getElementById('resource-input');
                    
                    if (gradeSelect) gradeSelect.value = workshopData.grade;
                    if (resourceInput) resourceInput.value = workshopData.resource;
                    break;
                    
                case 1:
                    // 선택된 자원 표시
                    const selectedResource = document.getElementById('selected-resource');
                    if (selectedResource) {
                        selectedResource.textContent = workshopData.resource || '입력된 자원 없음';
                    }
                    
                    // 역량 체크박스 복원
                    const competencyBoxes = document.querySelectorAll('input[name="competency"]');
                    competencyBoxes.forEach(cb => {
                        cb.checked = workshopData.competencies.includes(cb.value);
                    });
                    
                    const topicInput = document.getElementById('topic-input');
                    const objectivesInput = document.getElementById('objectives-input');
                    
                    if (topicInput) topicInput.value = workshopData.topic;
                    if (objectivesInput) objectivesInput.value = workshopData.objectives;
                    break;
                    
                case 2:
                    const introInput = document.getElementById('intro-input');
                    const wrapInput = document.getElementById('wrap-input');
                    const resourceHuman = document.getElementById('resource-human');
                    const resourceMaterial = document.getElementById('resource-material');
                    const resourceInfoCulture = document.getElementById('resource-info-culture');
                    const experienceInput = document.getElementById('experience-input');
                    
                    if (introInput) introInput.value = workshopData.intro;
                    if (wrapInput) wrapInput.value = workshopData.wrap;
                    if (resourceHuman) resourceHuman.value = workshopData.resourceTable.human;
                    if (resourceMaterial) resourceMaterial.value = workshopData.resourceTable.material;
                    if (resourceInfoCulture) resourceInfoCulture.value = workshopData.resourceTable.infoCulture;
                    if (experienceInput) experienceInput.value = workshopData.experience;
                    
                    renderMainActivities();
                    break;
                    
                case 3:
                    const effectsInput = document.getElementById('effects-input');
                    const expansionInput = document.getElementById('expansion-input');
                    
                    if (effectsInput) effectsInput.value = workshopData.effects;
                    if (expansionInput) expansionInput.value = workshopData.expansion;
                    break;
            }
        }

        // 메인 활동 관리
        function renderMainActivities() {
            const container = document.getElementById('main-activities-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (workshopData.mainActivities.length === 0) {
                workshopData.mainActivities = [{ content: '' }];
            }
            
            workshopData.mainActivities.forEach((activity, index) => {
                const div = document.createElement('div');
                div.className = 'main-activity-item space-y-2';
                div.innerHTML = `
                    <label for="main-activity-${index}" class="block text-gray-700 text-sm font-bold mb-2 mt-4">전개 (${index + 1}):</label>
                    <textarea id="main-activity-${index}" class="form-input" rows="6" placeholder="핵심 탐구 및 표현 활동..."></textarea>
                    ${index > 0 ? `<button type="button" class="remove-main-activity-btn mt-2 bg-red-200 hover:bg-red-300 text-red-800 font-bold py-1 px-3 rounded-lg text-sm">(-) 칸 삭제</button>` : ''}
                `;
                container.appendChild(div);
                
                const textarea = document.getElementById(`main-activity-${index}`);
                if (textarea) {
                    textarea.value = activity.content;
                    textarea.addEventListener('input', (e) => {
                        workshopData.mainActivities[index].content = e.target.value;
                    });
                }
            });
            
            // 삭제 버튼 이벤트 리스너 추가
            document.querySelectorAll('.remove-main-activity-btn').forEach((btn, index) => {
                btn.addEventListener('click', () => {
                    const actualIndex = parseInt(btn.previousElementSibling.id.split('-')[2]);
                    workshopData.mainActivities.splice(actualIndex, 1);
                    renderMainActivities();
                });
            });
        }

        function addMainActivity() {
            workshopData.mainActivities.push({ content: '' });
            renderMainActivities();
        }

        // AI 기능들
        async function callGeminiAPI(prompt, outputElementId, spinnerId) {
            if (!apiKey) {
                showOutput(outputElementId, '<p class="text-red-600">API 키를 먼저 설정해주세요.</p>');
                return;
            }

            const spinner = document.getElementById(spinnerId);
            const output = document.getElementById(outputElementId);

            if (spinner) spinner.classList.remove('hidden');
            if (output) output.classList.add('hidden');

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 1024
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`API 오류: ${response.status}`);
                }

                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (text) {
                    showOutput(outputElementId, `<h4 class="font-bold mb-2">✨ AI 제안:</h4><div>${formatAIResponse(text)}</div>`);
                } else {
                    showOutput(outputElementId, '<p class="text-red-600">응답을 생성할 수 없습니다.</p>');
                }
            } catch (error) {
                console.error('API 호출 실패:', error);
                showOutput(outputElementId, `<p class="text-red-600">오류가 발생했습니다: ${error.message}</p>`);
            } finally {
                if (spinner) spinner.classList.add('hidden');
            }
        }

        function showOutput(elementId, content) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = content;
                element.classList.remove('hidden');
            }
        }

        function formatAIResponse(text) {
            return text
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>');
        }

        // AI 함수들
        async function suggestIdeas() {
            const grade = workshopData.grade || document.getElementById('grade-select')?.value;
            const resource = workshopData.resource || document.getElementById('resource-input')?.value;

            if (!grade || !resource) {
                showOutput('suggested-ideas-output', '<p class="text-red-600">학년과 지역 자원을 모두 입력해주세요.</p>');
                return;
            }

            const prompt = `초등학교 ${grade} 학생들이 다음 지역 자원 '${resource}'을 활용한 창의적인 미술 활동 아이디어 3가지를 번호 매겨 제안해주세요. 각 아이디어는 활동명과 간단한 설명을 포함해야 합니다.`;
            await callGeminiAPI(prompt, 'suggested-ideas-output', 'suggest-ideas-spinner');
        }

        async function expandTopic() {
            const grade = workshopData.grade;
            const resource = workshopData.resource;
            const topic = document.getElementById('topic-input')?.value;

            if (!grade || !resource || !topic) {
                showOutput('expanded-topic-output', '<p class="text-red-600">학년, 동네 자원, 학습 주제를 모두 입력해주세요.</p>');
                return;
            }

            const prompt = `초등학교 ${grade} 학생들이 '${resource}' 자원을 활용하여 '${topic}' 주제로 미술 수업을 할 예정입니다. 이 학습 주제를 더 흥미롭고 깊이 있게 확장할 수 있는 아이디어를 2-3가지 번호 매겨 제안해주세요.`;
            await callGeminiAPI(prompt, 'expanded-topic-output', 'expand-topic-spinner');
        }

        async function suggestObjectives() {
            const grade = workshopData.grade;
            const resource = workshopData.resource;
            const topic = workshopData.topic || document.getElementById('topic-input')?.value;

            if (!grade || !resource || !topic) {
                showOutput('suggested-objectives-output', '<p class="text-red-600">학년, 동네 자원, 학습 주제를 모두 입력해주세요.</p>');
                return;
            }

            const prompt = `초등학교 ${grade} 학생들이 '${resource}' 자원을 활용하여 '${topic}' 주제로 미술 수업을 할 때, 달성할 수 있는 구체적인 학습 목표 3가지를 다음 순서대로 작성해주세요. 1. (미적 체험) 2. (표현) 3. (감상). 각 목표는 '~할 수 있다.' 형식이어야 합니다.`;
            await callGeminiAPI(prompt, 'suggested-objectives-output', 'suggest-objectives-spinner');
        }

        async function expandLearningActivity() {
            const grade = workshopData.grade;
            const topic = workshopData.topic;
            const objectives = workshopData.objectives;
            const intro = document.getElementById('intro-input')?.value;
            const wrap = document.getElementById('wrap-input')?.value;

            if (!grade || !topic || !objectives || (!intro && !wrap)) {
                showOutput('expanded-learning-activity-output', '<p class="text-red-600">학년, 학습 주제, 학습 목표, 활동 내용을 모두 입력해주세요.</p>');
                return;
            }

            const mainContents = workshopData.mainActivities.map(item => item.content.trim()).filter(content => content !== '').join('\n\n');

            const prompt = `초등학교 ${grade} 학생들이 '${topic}' 주제로 미술 수업을 할 예정입니다. 학습 목표는 '${objectives}' 이고, 현재 활동 내용은 다음과 같습니다: 도입: ${intro}, 전개: ${mainContents}, 정리: ${wrap}. 이 내용을 바탕으로 수업의 '전개' 부분에 들어갈 수 있는 구체적이고 다양한 학습 활동 아이디어를 3가지 번호 매겨 제안해주세요.`;
            await callGeminiAPI(prompt, 'expanded-learning-activity-output', 'expand-learning-activity-spinner');
        }

        async function suggestResources() {
            const grade = workshopData.grade;
            const resource = workshopData.resource;
            const topic = workshopData.topic;
            const objectives = workshopData.objectives;

            if (!grade || !resource || !topic || !objectives) {
                showOutput('suggested-resources-output', '<p class="text-red-600">학년, 동네 자원, 학습 주제, 학습 목표를 모두 입력해주세요.</p>');
                return;
            }

            const prompt = `초등학교 ${grade} 학생들이 '${resource}' 자원을 활용하여 '${topic}' 주제로 미술 수업을 할 예정입니다. 학습 목표는 '${objectives}' 입니다. 이 수업과 연관해서 활용할 수 있는 인적 자원, 물적 자원, 정보/문화 자원을 각각 1-2가지씩 구체적으로 추천해주세요.`;
            await callGeminiAPI(prompt, 'suggested-resources-output', 'suggest-resources-spinner');
        }

        async function expandExperience() {
            const grade = workshopData.grade;
            const resource = workshopData.resource;
            const topic = workshopData.topic;

            if (!grade || !resource || !topic) {
                showOutput('expanded-experience-output', '<p class="text-red-600">학년, 동네 자원, 학습 주제를 모두 입력해주세요.</p>');
                return;
            }

            const prompt = `초등학교 ${grade} 학생들이 '${topic}' 주제로 미술 수업을 할 예정입니다. '${resource}' 자원을 활용하여 실제로 실행 가능한 외부 체험 활동 아이디어를 2-3가지 번호 매겨 제안해주세요.`;
            await callGeminiAPI(prompt, 'expanded-experience-output', 'expand-experience-spinner');
        }

        async function suggestExpansion() {
            const grade = workshopData.grade;
            const topic = workshopData.topic;
            const effects = document.getElementById('effects-input')?.value;

            if (!grade || !topic || !effects) {
                showOutput('suggested-expansion-output', '<p class="text-red-600">학년, 학습 주제, 기대 효과를 모두 입력해주세요.</p>');
                return;
            }

            const prompt = `초등학교 ${grade}의 '${topic}' 미술 수업을 다른 교과나 활동으로 확장할 수 있는 방안을 2-3가지 번호 매겨 제안해주세요. 기대 효과는 '${effects}' 입니다.`;
            await callGeminiAPI(prompt, 'suggested-expansion-output', 'suggest-expansion-spinner');
        }

        // 워크샵 완료
        function completeWorkshop() {
            saveCurrentStepData();
            
            const summary = generateSummary();
            const summaryContent = document.getElementById('summary-content');
            if (summaryContent) {
                summaryContent.innerHTML = summary;
            }
            
            const workshopSteps = document.querySelectorAll('.workshop-step');
            const completeView = document.getElementById('complete-view');
            
            workshopSteps.forEach(step => step.classList.add('hidden'));
            if (completeView) completeView.classList.remove('hidden');
        }

        function generateSummary() {
            let mainActivitiesSummary = '';
            workshopData.mainActivities.forEach((activity, index) => {
                if (activity.content.trim() !== '') {
                    mainActivitiesSummary += `<li><strong>전개 (${index + 1}):</strong> ${activity.content || '-'}</li>`;
                }
            });
            if (mainActivitiesSummary === '') {
                mainActivitiesSummary = '<li>기록되지 않음</li>';
            }

            let resourceTableSummary = '';
            if (workshopData.resourceTable.human || workshopData.resourceTable.material || workshopData.resourceTable.infoCulture) {
                resourceTableSummary = `
                    <ul class="list-disc list-inside space-y-1">
                        <li><strong>인적 자원:</strong> ${workshopData.resourceTable.human || '-'}</li>
                        <li><strong>물적 자원:</strong> ${workshopData.resourceTable.material || '-'}</li>
                        <li><strong>정보, 문화 자원:</strong> ${workshopData.resourceTable.infoCulture || '-'}</li>
                    </ul>
                `;
            } else {
                resourceTableSummary = '기록되지 않음';
            }

            return `
                <p><strong>학년:</strong> ${workshopData.grade || '미선택'}</p>
                <p><strong>동네 자원:</strong> ${workshopData.resource || '미입력'}</p>
                <p><strong>핵심 역량:</strong> ${workshopData.competencies.join(', ') || '미선택'}</p>
                <p><strong>학습 주제:</strong> ${workshopData.topic || '미입력'}</p>
                <p><strong>학습 목표:</strong> ${workshopData.objectives || '미입력'}</p>
                <p><strong>도입 활동:</strong> ${workshopData.intro || '미입력'}</p>
                <p><strong>전개 활동:</strong> <ul>${mainActivitiesSummary}</ul></p>
                <p><strong>정리 활동:</strong> ${workshopData.wrap || '미입력'}</p>
                <p><strong>활용할 자원:</strong> ${resourceTableSummary}</p>
                <p><strong>체험 활동:</strong> ${workshopData.experience || '미입력'}</p>
                <p><strong>기대 효과:</strong> ${workshopData.effects || '미입력'}</p>
                <p><strong>확장 방안:</strong> ${workshopData.expansion || '미입력'}</p>
            `;
        }

        // 초기화
        function resetWorkshop() {
            if (!confirm('모든 입력 내용이 삭제됩니다. 계속하시겠습니까?')) return;

            // 데이터 초기화
            Object.keys(workshopData).forEach(key => {
                if (Array.isArray(workshopData[key])) {
                    workshopData[key] = key === 'mainActivities' ? [{ content: '' }] : [];
                } else if (typeof workshopData[key] === 'object') {
                    Object.keys(workshopData[key]).forEach(subKey => {
                        workshopData[key][subKey] = '';
                    });
                } else {
                    workshopData[key] = '';
                }
            });

            // 입력 필드 초기화
            document.querySelectorAll('input, textarea, select').forEach(el => {
                if (el.type === 'checkbox') el.checked = false;
                else el.value = '';
            });

            // AI 출력 숨기기
            document.querySelectorAll('[id$="-output"]').forEach(el => {
                el.classList.add('hidden');
            });

            // 첫 단계로 이동
            currentStep = 0;
            updateStepView();
            renderMainActivities();
            
            // 완료 뷰 숨기기
            const completeView = document.getElementById('complete-view');
            if (completeView) completeView.classList.add('hidden');
        }

        // 문서 저장 (새창에서 복사-붙여넣기 방식)
        function saveDocument() {
            const content = generateDocumentContent();
            const newWindow = window.open('', '_blank');
            
            if (newWindow) {
                newWindow.document.write(content);
                newWindow.document.close();
            } else {
                alert('팝업이 차단되었습니다. 팝업 허용 후 다시 시도해주세요.');
            }
        }

        function generateDocumentContent() {
            let mainActivitiesText = '';
            workshopData.mainActivities.forEach((activity, index) => {
                if (activity.content.trim() !== '') {
                    mainActivitiesText += `전개 (${index + 1}): ${activity.content}\n`;
                }
            });
            if (mainActivitiesText === '') {
                mainActivitiesText = '기록되지 않음';
            }

            let resourceTableText = '';
            if (workshopData.resourceTable.human || workshopData.resourceTable.material || workshopData.resourceTable.infoCulture) {
                resourceTableText = `
인적 자원: ${workshopData.resourceTable.human || '-'}
물적 자원: ${workshopData.resourceTable.material || '-'}
정보, 문화 자원: ${workshopData.resourceTable.infoCulture || '-'}
                `.trim();
            } else {
                resourceTableText = '활용할 자원 정보가 기록되지 않았습니다.';
            }

            return `
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <title>미술 수업 계획안</title>
                    <style>
                        body { 
                            font-family: 'Noto Sans KR', sans-serif; 
                            margin: 20px; 
                            line-height: 1.6; 
                            color: #333;
                        }
                        .copy-instruction {
                            background-color: #e3f2fd;
                            border: 1px solid #1976d2;
                            border-radius: 8px;
                            padding: 20px;
                            margin-bottom: 30px;
                            text-align: center;
                        }
                        .copy-instruction h2 {
                            color: #1976d2;
                            margin-top: 0;
                        }
                        .copy-steps {
                            text-align: left;
                            display: inline-block;
                        }
                        .plan-content {
                            background-color: #f9f9f9;
                            border: 1px solid #ddd;
                            border-radius: 8px;
                            padding: 20px;
                        }
                        h1 { 
                            color: #2C3E50; 
                            text-align: center; 
                            margin-bottom: 30px; 
                            font-size: 24px;
                        }
                        .section {
                            margin-bottom: 20px;
                            border-bottom: 1px solid #eee;
                            padding-bottom: 15px;
                        }
                        .section:last-child {
                            border-bottom: none;
                        }
                        .section-title {
                            font-weight: bold;
                            color: #1976d2;
                            margin-bottom: 8px;
                            font-size: 16px;
                        }
                        .section-content {
                            margin-left: 10px;
                            white-space: pre-line;
                        }
                    </style>
                </head>
                <body>
                    <div class="copy-instruction">
                        <h2>📋 문서 프로그램으로 복사하는 방법</h2>
                        <div class="copy-steps">
                            <p><strong>1단계:</strong> 아래 회색 영역의 모든 내용을 선택하세요 (Ctrl+A 또는 Cmd+A)</p>
                            <p><strong>2단계:</strong> 복사하세요 (Ctrl+C 또는 Cmd+C)</p>
                            <p><strong>3단계:</strong> <a href="https://docs.new" target="_blank" style="color: #1976d2;">Google 문서</a> 또는 Microsoft Word를 열고 붙여넣기 하세요 (Ctrl+V 또는 Cmd+V)</p>
                            <p><strong>4단계:</strong> 문서 제목을 변경하고 저장하세요</p>
                        </div>
                    </div>

                    <div class="plan-content">
                        <h1>미술 수업 계획안</h1>
                        
                        <div class="section">
                            <div class="section-title">학년</div>
                            <div class="section-content">${workshopData.grade || '미선택'}</div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">동네 자원</div>
                            <div class="section-content">${workshopData.resource || '미입력'}</div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">핵심 역량</div>
                            <div class="section-content">${workshopData.competencies.join(', ') || '미선택'}</div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">학습 주제</div>
                            <div class="section-content">${workshopData.topic || '미입력'}</div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">학습 목표</div>
                            <div class="section-content">${workshopData.objectives || '미입력'}</div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">도입 활동</div>
                            <div class="section-content">${workshopData.intro || '미입력'}</div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">전개 활동</div>
                            <div class="section-content">${mainActivitiesText}</div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">정리 활동</div>
                            <div class="section-content">${workshopData.wrap || '미입력'}</div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">활용할 자원</div>
                            <div class="section-content">${resourceTableText}</div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">체험 활동</div>
                            <div class="section-content">${workshopData.experience || '미입력'}</div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">기대 효과</div>
                            <div class="section-content">${workshopData.effects || '미입력'}</div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">확장 방안</div>
                            <div class="section-content">${workshopData.expansion || '미입력'}</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 15px; background-color: #f0f8ff; border-radius: 8px; text-align: center; font-size: 12px; color: #666;">
                        이 계획안은 미술교과 기반 지역연계 학교예술교육 워크숍에서 생성되었습니다.
                        <br>Copyright Yang Inseon. All rights reserved.
                    </div>
                </body>
                </html>
            `;
        }
    </script>
</body>
</html>
